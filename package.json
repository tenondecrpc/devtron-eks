{
  "name": "eks-cdk",
  "version": "0.1.0",
  "bin": {
    "main": "bin/main.js"
  },
  "scripts": {
    "build": "tsc",
    "test": "jest",
    "cdk": "cdk",
    "deploy": "cdk deploy --require-approval never --profile AWS_PROFILE",
    "destroy": "cdk destroy --profile AWS_PROFILE",
    "connect": "echo 'To connect to the EKS cluster:' && echo '' && echo '1. Automatic option (uses default name):' && echo '   npm run connect-cluster' && echo '' && echo '2. Manual option (specify cluster name):' && echo '   aws eks update-kubeconfig --region us-east-1 --name devtron-dev-cluster --profile AWS_PROFILE' && echo '' && echo 'After connecting, verify with:' && echo '   npm run status'",
    "connect-cluster": "echo 'Connecting to EKS cluster...' && aws eks update-kubeconfig --region us-east-1 --name devtron-dev-cluster --profile AWS_PROFILE && echo 'âœ… Connection configured. Verifying...' && kubectl cluster-info",
    "status": "kubectl cluster-info && kubectl get nodes",
    "pods": "kubectl get pods -A",
    "services": "kubectl get svc -A",
    "nodes": "kubectl get nodes --label-columns=eks.amazonaws.com/nodegroup",
    "events": "kubectl get events --sort-by=.metadata.creationTimestamp",
    "logs": "echo 'ğŸ’¡ Usage: npm run logs <pod-name> [container-name]' && echo 'Example: npm run logs my-pod' && echo 'View recent logs: npm run logs my-pod -- -f --tail=50' && kubectl logs",
    "fix-devtron-service": "echo 'ğŸ”§ Ensuring correct Devtron service configuration...' && echo '   Verifying and correcting service selector if necessary' && kubectl patch svc devtron-service -n devtroncd --type merge -p '{\"spec\":{\"selector\":{\"app\":\"dashboard\"}}}' && echo 'âœ… Service verified/corrected.'",
    "port-forward-devtron": "echo 'ğŸŒ To access Devtron:' && echo '' && echo '1. Run in a separate terminal:' && echo '   kubectl port-forward svc/devtron-service -n devtroncd 8080:80' && echo '' && echo '2. Open your browser at:' && echo '   http://localhost:8080' && echo '' && echo '3. Credentials:' && echo '   Username: admin' && kubectl get secret devtron-secret -n devtroncd -o jsonpath='{.data.ADMIN_PASSWORD}' | base64 -d | xargs echo '   Password:' && echo '' && echo 'To stop: Ctrl+C in the terminal'",
    "devtron-status": "echo 'ğŸ“Š Devtron access information...' && echo 'Port-forward command:' && echo 'kubectl port-forward svc/devtron-service -n devtroncd 8080:80' && echo '' && echo 'URL: http://localhost:8080' && echo '' && echo 'Username: admin' && echo 'Password:' && kubectl get secret devtron-secret -n devtroncd -o jsonpath='{.data.ADMIN_PASSWORD}' | base64 -d",
    "time-estimates": "echo 'â±ï¸ INSTALLATION TIME ESTIMATES â±ï¸' && echo '' && echo 'ğŸ“‹ COMPLETE PROCESS: 20-28 minutes' && echo '' && echo 'â”œâ”€â”€ CDK Deploy (EKS Cluster): 15-20 minutes' && echo 'â”œâ”€â”€ Helm Install Devtron: 1-8 minutes' && echo 'â”œâ”€â”€ Complete initialization: 5-8 minutes' && echo 'â””â”€â”€ Approximate total: 20-28 minutes' && echo '' && echo 'ğŸ’¡ Phases: Infrastructure â†’ Devtron â†’ Initialization' && echo 'ğŸ’¡ Use \"npm run progress\" for real-time monitoring' && echo 'ğŸš€ Recent Devtron versions are 5x faster than before!'",
    "progress": "echo 'ğŸ“ˆ CURRENT INSTALLATION STATUS ğŸ“ˆ' && echo '' && echo 'ğŸ” EKS Cluster:' && kubectl get nodes --no-headers 2>/dev/null | wc -l | xargs echo '   Active nodes:' || echo '   Active nodes: 0 (cluster not connected)' && kubectl get nodes --no-headers -o custom-columns=INSTANCE:.spec.providerID 2>/dev/null | head -1 | sed 's/.*i-//' | sed 's/\\/.*//' | xargs echo '   Instance type:' || echo '   Instance type: N/A' && echo '' && echo 'ğŸ³ Devtron Status:' && kubectl get pods -n devtroncd --no-headers 2>/dev/null | wc -l | xargs echo '   Total pods:' || echo '   Total pods: 0 (Devtron not installed)' && kubectl get pods -n devtroncd --no-headers 2>/dev/null | grep -c Running | xargs echo '   Running pods:' || echo '   Running pods: 0' && kubectl get installers installer-devtron -n devtroncd -o jsonpath='{.status.sync.status}' 2>/dev/null | xargs echo '   Installation status:' || echo '   Installation status: N/A (Devtron not installed)' && echo '' && echo 'ğŸŒ Next steps:' && kubectl get svc -n devtroncd devtron-service 2>/dev/null >/dev/null && echo '   âœ… Devtron installed - use \"npm run devtron-status\"' || echo '   ğŸ“‹ Next: Install Devtron with INSTALL_DEVTRON.md (5-8 min)'",
    "cost-analysis": "echo 'ğŸ’° COST ANALYSIS ğŸ’°' && echo '' && echo 'ğŸ“Š Current Configuration:' && kubectl get nodes --no-headers -o custom-columns=INSTANCE:.spec.providerID 2>/dev/null | head -1 | sed 's/.*i-//' | sed 's/\\/.*//' | xargs echo '   Instance type:' || echo '   Instance type: N/A (cluster not connected)' && kubectl get nodes --no-headers 2>/dev/null | wc -l | xargs echo '   Current node count:' || echo '   Current node count: 0' && echo '   Auto-scaling: 2-10 nodes (configurable)' && echo '' && echo 'ğŸ’µ Approximate monthly costs (us-east-1, 730h/month):' && echo '   t3.medium (2vCPU, 4GB): ~$32/node/month' && echo '   t3.large (2vCPU, 8GB): ~$64/node/month' && echo '   EKS control plane: ~$70/month' && echo '' && echo 'ğŸ” Recommendations:' && kubectl get pods -n devtroncd --no-headers 2>/dev/null | wc -l | xargs echo '   Devtron pods:' || echo '   Devtron pods: 0' && echo '   âœ… Development: t3.medium + 2-5 nodes (~$200-300/month)' && echo '   âš¡ Production: t3.large + 3-10 nodes (~$400-800/month)' && echo '   ğŸ’¡ Optimization: Review instances every 2-4 weeks'",
    "health-check": "echo 'ğŸ¥ SYSTEM HEALTH CHECK ğŸ¥' && echo '' && echo 'ğŸ” Cluster status:' && kubectl cluster-info 2>/dev/null | head -1 || echo '   âŒ Cluster not connected' && echo '' && echo 'ğŸ“Š System resources:' && kubectl top nodes 2>/dev/null | tail -n +2 | awk '{print \"   \" $1 \": CPU=\" $2 \", Memory=\" $3}' || echo '   âš ï¸  Information not available' && echo '' && echo 'ğŸ³ Critical pods status:' && kubectl get pods -n kube-system 2>/dev/null | grep -E '(coredns|kube-proxy|aws-node)' | awk '{print \"   \" $1 \": \" $3}' || echo '   âš ï¸  System components not found' && echo '' && echo 'ğŸ’¡ Recommendations:' && kubectl get events --field-selector type=Warning 2>/dev/null | wc -l | xargs echo '   Recent warning events:' | sed 's/0/âœ… System healthy/' | sed 's/[1-9].*/âš ï¸  Review recent events/' || echo '   âš ï¸  Cannot verify events'",
    "cluster-info": "echo 'â„¹ï¸  DETAILED CLUSTER INFORMATION â„¹ï¸' && echo '' && echo 'ğŸ” Basic information:' && kubectl cluster-info && echo '' && echo 'ğŸ“Š Node statistics:' && kubectl get nodes -o custom-columns=NAME:.metadata.name,STATUS:.status.conditions[3].status,AGE:.status.nodeInfo.age,VERSION:.status.nodeInfo.kubeletVersion && echo '' && echo 'ğŸ³ Cluster resources:' && kubectl top nodes 2>/dev/null || echo '   âš ï¸  Metrics not available (install metrics-server)' && echo '' && echo 'ğŸ“¦ Namespaces:' && kubectl get namespaces --no-headers | wc -l | xargs echo '   Total namespaces:' && echo '' && echo 'ğŸ” Current context:' && kubectl config current-context",
    "verify-setup": "echo 'ğŸ” COMPLETE SETUP VERIFICATION ğŸ”' && echo '' && echo '1. ğŸ“‹ Prerequisites:' && which kubectl >/dev/null 2>&1 && echo '   âœ… kubectl installed' || echo '   âŒ kubectl not found' && which helm >/dev/null 2>&1 && echo '   âœ… helm installed' || echo '   âŒ helm not found' && which aws >/dev/null 2>&1 && echo '   âœ… awscli installed' || echo '   âŒ awscli not found' && echo '' && echo '2. ğŸ” AWS Configuration:' && aws sts get-caller-identity >/dev/null 2>&1 && echo '   âœ… AWS credentials configured' || echo '   âŒ AWS credentials not found' && echo '' && echo '3. â˜¸ï¸  Kubernetes Connection:' && kubectl cluster-info >/dev/null 2>&1 && echo '   âœ… Connected to cluster' || echo '   âŒ Not connected to cluster' && echo '' && echo '4. ğŸ“¦ Devtron Status:' && kubectl get pods -n devtroncd >/dev/null 2>&1 && echo '   âœ… Devtron installed' || echo '   âŒ Devtron not installed'",
    "backup-config": "echo 'ğŸ’¾ CREATING CONFIGURATION BACKUP ğŸ’¾' && echo '' && mkdir -p backups/$(date +%Y%m%d_%H%M%S) && echo 'ğŸ“ Creating backup directory...' && cp -r lib/ backups/$(date +%Y%m%d_%H%M%S)/ 2>/dev/null && cp package*.json backups/$(date +%Y%m%d_%H%M%S)/ 2>/dev/null && cp cdk.* backups/$(date +%Y%m%d_%H%M%S)/ 2>/dev/null && cp .env backups/$(date +%Y%m%d_%H%M%S)/ 2>/dev/null && echo 'âœ… Backup completed at: backups/'$(date +%Y%m%d_%H%M%S) && echo 'ğŸ“‹ Files included: CDK config, package.json, .env'",
    "cleanup-devtron": "echo 'ğŸ—‘ï¸ CLEANING UP DEVTRON COMPLETELY ğŸ—‘ï¸' && echo '' && echo 'Step 1: Uninstalling Helm release...' && helm uninstall devtron -n devtroncd --ignore-not-found=true && echo 'Step 2: Removing namespace devtroncd...' && kubectl delete namespace devtroncd --ignore-not-found=true && echo 'Step 3: Removing related namespaces...' && kubectl delete namespace devtron-cd --ignore-not-found=true && kubectl delete namespace devtron-ci --ignore-not-found=true && kubectl delete namespace devtron-demo --ignore-not-found=true && echo 'Step 4: Waiting for cleanup...' && sleep 10 && echo 'Step 5: Verification...' && kubectl get namespaces | grep -i devtron || echo '   âœ… No Devtron namespaces found' && kubectl get pods -A | grep -i devtron || echo '   âœ… No Devtron pods found' && echo '' && echo 'âœ… Devtron cleanup completed!'",
    "cleanup-devtron-force": "echo 'ğŸ’¥ FORCE CLEANING DEVTRON ğŸ’¥' && echo '' && echo 'âš ï¸  This will force delete all Devtron resources...' && kubectl delete namespace devtroncd --ignore-not-found=true --timeout=30s --grace-period=0 --force && kubectl delete namespace devtron-cd --ignore-not-found=true --timeout=30s --grace-period=0 --force && kubectl delete namespace devtron-ci --ignore-not-found=true --timeout=30s --grace-period=0 --force && kubectl delete namespace devtron-demo --ignore-not-found=true --timeout=30s --grace-period=0 --force && echo 'âœ… Force cleanup completed!'",
    "cleanup-devtron-complete": "echo 'ğŸ’€ COMPLETE DEVTRON DESTRUCTION ğŸ’€' && echo '' && echo 'âš ï¸  This will completely remove ALL Devtron resources from the cluster...' && echo '' && echo 'Step 1: Check existing Devtron resources...' && kubectl get namespaces | grep devtron && echo '' && echo 'Step 2: Remove all Devtron namespaces...' && kubectl delete namespace devtroncd --ignore-not-found=true && kubectl delete namespace devtron-ci --ignore-not-found=true && kubectl delete namespace devtron-demo --ignore-not-found=true && echo '' && echo 'Step 3: Remove cluster-level resources...' && kubectl delete clusterrolebinding devtron --ignore-not-found=true && kubectl delete clusterrole devtron --ignore-not-found=true && echo '' && echo 'Step 4: Remove Custom Resource Definition...' && kubectl delete crd installers.installer.devtron.ai --ignore-not-found=true && echo '' && echo 'Step 5: Final verification...' && echo 'Checking for remaining Devtron resources:' && kubectl get namespaces | grep devtron || echo '   âœ… No Devtron namespaces found' && kubectl get clusterrole | grep devtron || echo '   âœ… No Devtron cluster roles found' && kubectl get clusterrolebinding | grep devtron || echo '   âœ… No Devtron cluster role bindings found' && kubectl get crd | grep devtron || echo '   âœ… No Devtron CRDs found' && echo '' && echo 'ğŸ‰ COMPLETE DEVTRON DESTRUCTION FINISHED!'",
    "cleanup-devtron-dry-run": "echo 'ğŸ” DEVTRON CLEANUP DRY RUN ğŸ”' && echo '' && echo 'Resources that would be deleted:' && echo 'Namespaces:' && kubectl get namespaces | grep -i devtron || echo '   None found' && echo 'Pods:' && kubectl get pods -A | grep -i devtron || echo '   None found' && echo 'Services:' && kubectl get svc -A | grep -i devtron || echo '   None found' && echo 'Deployments:' && kubectl get deployments -A | grep -i devtron || echo '   None found' && echo 'Helm releases:' && helm list -A | grep -i devtron || echo '   None found'",
    "cleanup-devtron-pvcs": "echo 'ğŸ—‚ï¸ CLEANING UP DEVTRON PERSISTENT VOLUMES ğŸ—‚ï¸' && echo '' && echo 'Finding Devtron PVCs...' && kubectl get pvc -A | grep -i devtron || echo '   No Devtron PVCs found' && echo 'Finding Devtron PVs...' && kubectl get pv | grep -i devtron || echo '   No Devtron PVs found' && echo 'To delete PVCs run: kubectl delete pvc -n devtroncd --all'",
    "check-devtron-resources": "echo 'ğŸ” CHECKING DEVTRON RESOURCES ğŸ”' && echo '' && echo 'Namespaces:' && kubectl get namespaces | grep devtron || echo '   None found' && echo '' && echo 'Cluster Roles:' && kubectl get clusterrole | grep devtron || echo '   None found' && echo '' && echo 'Cluster Role Bindings:' && kubectl get clusterrolebinding | grep devtron || echo '   None found' && echo '' && echo 'CRDs:' && kubectl get crd | grep devtron || echo '   None found' && echo '' && echo 'Helm Releases:' && helm list -A | grep devtron || echo '   None found'",
    "devtron-performance": "echo 'ğŸš€ DEVTRON PERFORMANCE UPDATE ğŸš€' && echo '' && echo 'ğŸ“Š Recent Installation Times (EKS):' && echo '   Helm Install: 1-8 minutes' && echo '   Complete Setup: 5-8 minutes' && echo '   Total: 5-8 minutes' && echo '' && echo 'âš¡ Performance Improvements:' && echo '   Previous versions: 20-50 minutes' && echo '   Current version: 5-8 minutes' && echo '   Improvement: 5x faster!' && echo '' && echo 'ğŸ¯ Why So Fast Now?' && echo '   âœ… Optimized Helm charts for EKS' && echo '   âœ… Better CRD installation' && echo '   âœ… Improved service mesh setup' && echo '   âœ… PostgreSQL optimization' && echo '' && echo 'ğŸ’¡ Use \"npm run time-estimates\" for complete timeline'"
    "quick-start": "echo 'ğŸš€ QUICK START GUIDE ğŸš€' && echo '' && echo 'ğŸ“‹ Steps to get started:' && echo '' && echo '1. ğŸ› ï¸  Configure environment variables:' && echo '   export ENV_NAME=dev' && echo '   export PROJECT_NAME=devtron' && echo '   export AWS_ACCOUNT=your-aws-account' && echo '   export AWS_REGION=us-east-1' && echo '' && echo '2. â˜¸ï¸  Deploy EKS cluster:' && echo '   npm run deploy' && echo '' && echo '3. ğŸ”— Connect to cluster:' && echo '   npm run connect-cluster' && echo '' && echo '4. ğŸ“Š Check status:' && echo '   npm run progress' && echo '' && echo '5. ğŸš€ Install Devtron:' && echo '   Follow INSTALL_DEVTRON.md (5-8 min)' && echo '' && echo '6. ğŸŒ Access Devtron:' && echo '   npm run devtron-status' && echo '' && echo 'ğŸ—‘ï¸ Cleanup Devtron:' && echo '   npm run cleanup-devtron (standard)' && echo '   npm run cleanup-devtron-complete (full destruction)'"
  },
  "devDependencies": {
    "@types/dotenv": "^6.1.1",
    "@types/jest": "^29.5.14",
    "@types/node": "22.7.9",
    "aws-cdk": "2.1026.0",
    "jest": "^29.7.0",
    "ts-jest": "^29.2.5",
    "ts-node": "^10.9.2",
    "typescript": "~5.6.3"
  },
  "dependencies": {
    "@aws-cdk/aws-eks-v2-alpha": "^2.213.0-alpha.0",

    "aws-cdk-lib": "^2.213.0",
    "constructs": "^10.0.0",
    "dotenv": "^17.2.1"
  }
}
